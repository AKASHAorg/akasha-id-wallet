# akasha-id-lib
DID library for AKASHA.id, comprised of a "wallet" and a client.

## DIDClient

To initialize the client, you will need a list of attributes for the application you are creating, such as the application `name`, a short `description`, an app `image URL`, and finally the `app URL`. You can also pass an optional configuration parameter (as an object).

```JavaScript
const config = {
    hubUrls: ['https://examplehub1.com'],
    walletUrl: 'https://akasha.id/#/wallet/',
    debug: true
}
const client = new DIDclient(
    'AKASHA.world',
    'The super cool AKASHA World app!',
    'https://app.akasha.world/icon.png',
    'https://app.akasha.world',
    config)
```

The next step is to generate the initial request/login link in the app, and then display it as a button or a link for the users to click. You can also put it in a QR code.

```JavaScript
const link = await client.genLoginLink()
// -> https://akasha.id/#/wallet/WyJhIiwiMDVjZjBjNzZmMGMwZTNmNjUwODVhYTA1YmZmODFkMGI3MmI1M2VmOSIsIkVEZUJLekpwUkoyeVhUVnVncFRTQ2c9PSIsMTY4NzQ2NF0=
```

At the same time, attach an event listener on the link/button that triggers the login request, listening for the response coming from the AKASHA.id app.

```JavaScript
const response = await client.requestProfile()
```

The response object will contain the following attributes. It should be stored locally (client-side) for future use.

```JavaScript
{
    allowed: true, // or false if the user denyed the request
    claim: { ... }, // an object containing the profile attributes shared by the user
    token: 'e6122c80e7a293901244e5cb87c32546692d5651', // unique ID for this app that is used for future requests
    refreshEncKey: '3gCE799TuL9QN5huAJ+aTg==', // one-time-use encryption key for the next request
    queryChannel: '8266f130e0d85f4bf7ff19e0a6df2fb3776eb7c1' // where to send the refresh requests
}
```

If the app would like to request a fresh copy of the profile data, it can send a `refreshProfile` request.

```JavaScript
const updated = await client.refreshProfile(response.queryChannel, response.token, response.refreshEncKey)
// console.log(updated) results in the same response object as above
```

## DIDWallet

The wallet handles requests for the user's profile attributes. It accepts a configuration parameter (as an object) that contains the `hubUrls`. The hubs values must be the same as the ones used by the `DIDclient`.

```JavaScript
const config = {
    hubUrls: ['https://examplehub1.com'],
    debug: true
}
const wallet = new DIDwallet(config)
// do not forget to init the listener
await wallet.init()
```

When a the user clicks the login link generated by a "client" app, or when the QR code is scanned, the link needs to be parsed in order to get to the relevant request data.

```JavaScript
// Assuming a the link was the following
const link = 'https://akasha.id/#/wallet/WyJhIiwiMDVjZjBjNzZmMGMwZTNmNjUwODVhYTA1YmZmODFkMGI3MmI1M2VmOSIsIkVEZUJLekpwUkoyeVhUVnVncFRTQ2c9PSIsMTY4NzQ2NF0='
const rawData = link.substring(27) // strip https://akasha.id/#/wallet/
const request = wallet.parseLoginLink(rawData)
```

Next the wallet app should display a dialog to the user prompting them to select which profile attributes to disclose, resulting in an `attributes` object.

```JavaScript
const attributes = { ... }
// respond
await wallet.sendClaim(request, attributes, true)
```

You can also use `false` and `null/empty` attributes obj to deny a request

```JavaScript
await wallet.sendClaim(parsed, null, false)
```