# akasha-id-wallet
[DID](https://w3c-ccg.github.io/did-spec/) wallet library for AKASHA.id, which handles requests
for the user's profile attributes. It is meant to be used by the AKASHA.id application to
exchange profile attributes with 3rd party applications.

## Install

### Via `<script>` tag

You can call `window.AKASHAidWallet` in browsers by using `dist/akasha-id-wallet.js`.

### Via npm

`npm install --save git+https://github.com/AkashaProject/akasha-id-wallet`

```js
const Wallet = require('akasha-id-wallet')
```

# Wallet API

When instantiating the wallet, you can pass an optional configuration parameter (as an object)
that contains the `hubUrls`.

```js
const Wallet = require('akasha-id-wallet')

const config = {
    hubUrls: ['https://examplehub1.com'],
    debug: true // display console.log statements for debug purposes
}
// instantiate the wallet
const wallet = new Wallet(config)
// initialize
await wallet.init()
```

## Handling profiles

The wallet allows us to have multiple profiles or "personas", perhaps describing us in different ways. When using the app for the first time, you will go through a "signup"-like process, in which you provide a `name` for that profile and a `passphrase` that will be used to encrypt the local data stored by the app. The concept is very similar to creating and logging into a local account on your computer.

### Listing all profiles before login/signup

```js
const profiles = wallet.publicProfiles()
// console.log(profiles) -> []
```

### Signup

Once the `signup()` call has completed the user will be logged in by default. 

```js
const profileName = 'jane'
const passphrase = 'some super secure pass'

const id = await wallet.signup(profileName, passphrase)
// jane is now logged in, you can now list apps or do something with the profile ID
```

### Login

```js
const profiles = wallet.publicProfiles()
// console.log(profiles) -> [{id: "5285c2476202a56b05e1be3b4222402d", user: "test", picture: "https://example.org/jane.jpg"}]

// let's fake select the profile
const user = profiles[0]

// get the passphrase from a password input field

// always use the ID to call the login() method, as profile names may change in the future
await wallet.login(user.id, passphrase)

// do something like listing apps, etc.
```

### Logout

```js
await wallet.logout()
```

### Update public profile used in the list

```js
const profiles = wallet.publicProfiles()
// console.log(profiles) -> [{id: "5285c2476202a56b05e1be3b4222402d", user: "test", picture: "https://example.org/jane.jpg"}]

// pick jane's profile
const janeProfile = profiles[0]
// let's change the profile name
janeProfile.name = 'janedoe'

await wallet.updateProfileList (userId, data)
```

### Load the current private profile

This is the full profile that contains a list of attributes which can be used to create a claim
for a 3rd party application.

```js
const userProfile = await wallet.profile()
// console.log(userProfile) -> { givenName: 'foo', email: 'foo@bar.org' }
```

### Update the current private profile

```js
const profile = {
    givenName: 'foo',
    email: 'foo@example.org' // we changed the email
}
await wallet.updateProfile(profile)
```

### Remove a profile

```js
const profiles = wallet.publicProfiles()
// console.log(profiles) -> [{id: "5285c2476202a56b05e1be3b4222402d", user: "test", picture: "https://example.org/jane.jpg"}]
// pick jane's profile
const janeProfile = profiles[0]

await wallet.removeProfile(janeProfile.id)
```

### Export a profile

It will export the encrypted data as one JSON object.

```js
const dump = await wallet.export()
```

### Import a profile

The optional `profileName` parameter can be used to import the profile under a different
name than the original one. Note that the unique ID remains the same!

```js
const profileName = 'jane from backup'
// using the dump object and the same passphrase used when creating the profile above
await wallet.import(dump, pass, profileName)
```

### Update the passphrase that is used to protect the encryption key

```js
await Wallet.updatePassphrase(oldPass, newPass)
```


## Handling new apps

When a user clicks the link (or scans a QR code) generated by a "client" app, they will be taken to the AKASHA.id app (i.e. the "wallet"). Once there, the link needs to be parsed in order to get to the relevant request data generated by the 3rd party app (i.e. the client).


### Register a new app based on an external request

```js
// Assuming a the link was the following
const link = 'https://akasha.id/#/wallet/WyJhIiwiMDVjZjBjNzZmMGMwZTNmNjUwODVhYTA1YmZmODFkMGI3MmI1M2VmOSIsIkVEZUJLekpwUkoyeVhUVnVncFRTQ2c9PSIsMTY4NzQ2NF0='
const rawRequest = link.substring(27) // to strip https://akasha.id/#/wallet/
// parse the link to get the initial handshake attributes
const request = await wallet.registerApp(rawRequest)
```

The `request` contents will look similar to the object below.

```js
{
    appInfo: {name: "AKASHA.world", description: "The super cool AKASHA World app!", icon: "https://app.akasha.world/icon.png", url: "https://app.akasha.world"},
    attributes: ['name', 'email'],
    channel: "1ce120a6f8630283db7c434ce74541831b4106a2"
    key: "VCm7C1ci28M+8TFf2LA4PA=="
    nonce: 579482
    token: "4962391a0dbf2abee7e0ea4d07814aa16cc2cefc"
}
```

The wallet app can now use the `appInfo` data to display a modal/page to the user, informing them about the app that is currently requesting access to the profile elements. At the same time, it
can also inform the user at to what attributes they should disclose specifically for this app --
e.g. `attributes: ['name', 'email']` above -- out of all the profile attributes they may have in
their AKASHA.id profile.

```js
...

// display a modal with data from request.appInfo as well as a list of attributes

...

// collect all the selected attributes in an attributes object
const attributes = ['givenName', 'email']

...

// don't forget to add the app to the user's list of allowed apps
await wallet.addApp(request.token, request.appInfo)

// send the claim
await wallet.sendClaim(request, attributes, true) 
```

You can also use `false` and `null/empty` attributes obj to deny a request. In this case you will
not have to save the app to the list though.

```js
await wallet.sendClaim(request, null, false)
```

### List all apps for a user

Returns a map of app tokens to app description objects.

```js
const apps = await wallet.apps()

// console.log(apps) -> {b783046f15ba3c8e9de9bbf2797cc87a: {name: "AKASHA.world", description: "The super cool AKASHA World app!", icon: "https://app.akasha.world/icon.png", url: "https://app.akasha.world"}}

```

### Remove an app

To remove a claim created for a specific app, you can use the app token when calling `removeApp()`.

```js
await wallet.removeApp(token)
```